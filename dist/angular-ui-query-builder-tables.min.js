"use strict";angular.module("angular-ui-query-builder").service("qbTableSettings",function(){return{icons:{sortNone:"fa fa-fw fa-sort text-muted",sortAsc:"fa fa-fw fa-sort-alpha-asc text-primary",sortDesc:"fa fa-fw fa-sort-alpha-desc text-primary"}}}).directive("qbTable",function(){return{scope:{qbTable:"=?",stickyThead:"<?",stickyTfoot:"<?"},restrict:"AC",controller:["$attrs","$element","$scope","qbTableSettings",function(t,e,a,n){var l=this;l.query=a.qbTable,l.$broadcast=function(t){for(var e,n=arguments.length,l=Array(n>1?n-1:0),r=1;r<n;r++)l[r-1]=arguments[r];(e=console).log.apply(e,["BROADCAST DOWN",t].concat(l)),a.$broadcast.apply(a,[t].concat(l))},l.$on=function(t,e){return a.$on(t,e)},l.setField=function(t,e){if(void 0!=e)switch(t){case"sort":l.query.sort===e?l.query.sort="-"+e:(l.query.sort,l.query.sort=e);break;default:a.qbTable[t]=e}else delete l.query[t]},e.addClass("qb-table"),a.$watch("stickyThead",function(){return e.toggleClass("qb-sticky-thead",a.stickyThead||""===t.stickyThead)}),a.$watch("stickyTfoot",function(){return e.toggleClass("qb-sticky-tfoot",a.stickyTfoot||""===t.stickyTfoot)})}]}}).directive("qbCol",function(){return{scope:{qbCol:"@",sortable:"@"},require:"^qbTable",restrict:"A",transclude:!0,controller:["$attrs","$element","$scope","qbTableSettings",function(t,e,a,n){var l=this;a.qbTableSettings=n;var r=a.$watchGroup(["qbTable","sortable"],function(){""!==t.sortable||a.qbTable||console.warn("Added qb-col + sortable onto element",e,"but no qb-table query has been assigned on the table element!"),r()});a.canSort=!1,a.isSorted=!1,l.$onInit=function(){return a.canSort=a.sortable||""===t.sortable},a.$watch("qbTable.query.sort",function(t){var e=a.sortable||a.q;t?angular.isArray(t)&&t.some(function(t){return t==e})||t==e?a.isSorted="asc":angular.isArray(t)&&t.some(function(t){return t=="-"+e})||t=="-"+e?a.isSorted="desc":a.isSorted=!1:a.isSorted=!1}),a.toggleSort=function(){a.sortable?a.qbTable.setField("sort",a.sortable):a.qbCol&&""===t.sortable&&a.qbTable.setField("sort",a.qbCol)}}],link:function(t,e,a,n){t.qbTable=n},template:'\n\t\t<ng-transclude></ng-transclude>\n\t\t<a ng-if="canSort" ng-click="toggleSort()" class="pull-right">\n\t\t\t<i class="{{\n\t\t\t\tisSorted == \'asc\' ? qbTableSettings.icons.sortAsc\n\t\t\t\t: isSorted == \'desc\' ? qbTableSettings.icons.sortDesc\n\t\t\t\t: qbTableSettings.icons.sortNone\n\t\t\t}}"></i>\n\t\t</a>\n\t'}}).directive("qbCell",function(){return{scope:{selector:"=?"},require:"^qbTable",restrict:"A",transclude:!0,controller:["$attrs","$element","$scope","$timeout","qbTableSettings",function(t,e,a,n,l){a.qbTableSettings=l,a.isMeta=e.parents("thead").length>0,a.isSelector="selector"in t,a.$watch("selector",function(){a.isSelector&&e.toggleClass("selector",a.isSelector),a.isSelector&&!a.isMeta&&(e.parents("tr").toggleClass("selected",!!a.selector),e.find("input[type=checkbox]").prop("checked",!!a.selector))}),e.on("click",function(t){"INPUT"!=t.target.tagName&&t.preventDefault(),a.$apply(function(){return a.selector=!a.selector})}),a.metaSelect=function(t){return a.qbTable.$broadcast("qbTableCellSelect",t)},a.isSelector&&n(function(){return a.qbTable.$on("qbTableCellSelect",function(t,e){switch(e){case"all":a.selector=!0;break;case"invert":a.selector=!a.selector;break;case"none":a.selector=!1;break;default:throw new Error("Unknown selection type: "+e)}})}),e.addClass("qb-cell")}],link:function(t,e,a,n){t.qbTable=n},template:'\n\t\t<ng-transclude></ng-transclude>\n\t\t<div ng-if="isSelector && isMeta" class="btn-group">\n\t\t\t<a class="btn btn-default dropdown-toggle" data-toggle="dropdown">\n\t\t\t\t<input type="checkbox"/>\n\t\t\t\t<i class="fa fa-caret-down"></i>\n\t\t\t</a>\n\t\t\t<ul class="dropdown-menu">\n\t\t\t\t<li><a ng-click="metaSelect(\'all\')">All</a></li>\n\t\t\t\t<li><a ng-click="metaSelect(\'invert\')">Invert</a></li>\n\t\t\t\t<li><a ng-click="metaSelect(\'none\')">None</a></li>\n\t\t\t</ul>\n\t\t</div>\n\t\t<div ng-if="isSelector && !isMeta" class="checkbox">\n\t\t\t<label>\n\t\t\t\t<input type="checkbox"/>\n\t\t\t</label>\n\t\t</div>\n\t'}}).directive("qbPagination",function(){return{scope:{},require:"^qbTable",restrict:"EA",controller:["$attrs","$scope","qbTableSettings",function(t,e,a){e.qbTableSettings=a,e.canPrev=!0,e.canNext=!0,e.$watchGroup(["qbTable.query.limit","qbTable.query.skip"],function(t){e.canPrev=e.qbTable.query.skip>0,e.canNext=!e.total||e.qbTable.query.skip+e.qbTable.query.limit<e.total}),e.navPageRelative=function(t){if(-1==t)e.qbTable.setField("skip",Math.min((e.qbTable.query.skip||0)-(e.qbTable.query.limit||10),0));else{if(1!=t)throw new Error("Unsupported page move: "+t);e.qbTable.setField("skip",(e.qbTable.query.skip||0)+(e.qbTable.query.limit||10),0)}}}],link:function(t,e,a,n){t.qbTable=n},template:'\n\t\t<nav>\n\t\t\t<ul class="pager">\n\t\t\t\t<li ng-class="canPrev ? \'\' : \'disabled\'" class="previous"><a ng-click="navPageRelative(-1)"><i class="fa fa-arrow-left"></i></a></li>\n\t\t\t\t<li ng-class="canNext ? \'\' : \'disabled\'" class="next"><a ng-click="navPageRelative(1)"><i class="fa fa-arrow-right"></i></a></li>\n\t\t\t</ul>\n\t\t</nav>\n\t'}});